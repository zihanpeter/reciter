<!DOCTYPE html>
<html>
<head>
    <title>Tetris Game</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            min-height: 100vh;
        }

        .game-header {
            width: 100%;
            text-align: center;
            margin: 5px 0;
        }

        h1 {
            margin: 5px 0;
            font-size: 24px;
        }

        .score-container {
            background: #bbada0;
            padding: 8px 15px;
            border-radius: 6px;
            color: white;
            font-size: 20px;
            margin: 5px;
            text-align: center;
        }

        .score-label {
            font-size: 14px;
            color: #eee4da;
            margin-bottom: 3px;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .controls {
            text-align: center;
            margin: 5px 0;
        }

        .button {
            padding: 8px 15px;
            margin: 0 5px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
        }

        .game-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 5px auto;
            flex-wrap: wrap;
        }

        #gameBoard {
            width: 300px;
            height: 600px;
            border: 2px solid #333;
            position: relative;
            background-color: #fff;
            max-width: 90vw;
            max-height: 80vh;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .next-title {
            font-size: 18px;
            margin-bottom: 5px;
            color: #333;
        }

        #nextPiece {
            width: 100px;
            height: 100px;
            border: 2px solid #333;
            position: relative;
            background: #fff;
        }

        .block {
            width: 30px;
            height: 30px;
            position: absolute;
            border: 1px solid #fff;
            box-sizing: border-box;
            transform-origin: center center;
        }
        #score {
            text-align: center;
            font-size: 24px;
            margin: 10px;
        }
        #gameOver {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: red;
        }
        .pause-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 48px;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            text-align: center;
        }
        .pause-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .controls {
            text-align: center;
            margin: 10px;
        }
        .button {
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
        }
        #nextPiece {
            width: 120px;
            height: 120px;
            border: 2px solid #333;
            position: relative;
            margin: 20px auto;
            background: #f0f0f0;
        }
        .game-container {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .side-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .next-title {
            font-size: 20px;
            margin-bottom: 10px;
        }
        .game-over-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            min-width: 300px;
        }
        
        .modal-title {
            font-size: 36px;
            color: #776e65;
            margin-bottom: 20px;
        }
        
        .modal-score {
            font-size: 28px;
            margin: 20px 0;
            color: #776e65;
        }
        
        .modal-button {
            background-color: #8f7a66;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        
        .modal-button:hover {
            background-color: #7f6a56;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .grid-line-vertical {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background-color: rgba(0, 0, 0, 0.1);
        }

        .grid-line-horizontal {
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background-color: rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 600px) {
            .game-header {
                width: 90vw;
            }
            
            #gameBoard {
                width: 90vw;
                height: calc(90vw * 2);
            }
            
            .block {
                width: calc(90vw / 10);
                height: calc(90vw / 10);
            }
            
            #nextPiece {
                width: calc(90vw / 3);
                height: calc(90vw / 3);
            }
        }
    </style>
</head>
<body>
    <div class="game-header">
        <h1>Tetris</h1>
        <div class="score-container">
            <div class="score-label">SCORE</div>
            <div class="score-value" id="scoreValue">0</div>
        </div>
        <div class="controls">
            <button class="button" onclick="resetGame()">Restart</button>
            <button class="button" onclick="togglePause()">Pause/Continue</button>
            <button class="button" onclick="toggleSound()">
                <span id="soundIcon">ğŸ”Š</span>
            </button>
        </div>
    </div>

    <div class="game-container">
        <div id="gameBoard">
            <div id="pauseScreen" class="pause-screen">
                <div class="pause-text">PAUSE</div>
            </div>
        </div>
        <div class="side-panel">
            <div class="next-title">Next:</div>
            <div id="nextPiece"></div>
        </div>
    </div>

    <div class="game-over-modal" id="gameOverModal">
        <div class="modal-content">
            <h2 class="modal-title">Game Over!</h2>
            <div class="modal-score">
                Final Score: <span id="finalScore">0</span>
            </div>
            <button class="modal-button" onclick="resetGame()">Try Again</button>
        </div>
    </div>

    <script>
        const BOARD_WIDTH = 10;
        const BOARD_HEIGHT = 20;
        const BLOCK_SIZE = 30;
        
        // å®šä¹‰æ–¹å—å½¢çŠ¶
        const SHAPES = [
            [[1, 1, 1, 1]], // I
            [[1, 1], [1, 1]], // O
            [[1, 1, 1], [0, 1, 0]], // T
            [[1, 1, 1], [1, 0, 0]], // L
            [[1, 1, 1], [0, 0, 1]], // J
            [[1, 1, 0], [0, 1, 1]], // S
            [[0, 1, 1], [1, 1, 0]]  // Z
        ];
        
        const COLORS = ['#00f0f0', '#f0f000', '#a000f0', '#f0a000', '#0000f0', '#00f000', '#f00000'];
        
        let board = Array(BOARD_HEIGHT).fill().map(() => Array(BOARD_WIDTH).fill(0));
        let score = 0;
        let currentShape;
        let currentColor;
        let currentX;
        let currentY;
        
        let isPaused = false;
        let gameInterval;
        
        let nextShape;
        let nextColor;
        
        function createNewShape() {
            if (nextShape === undefined) {
                const randomIndex = Math.floor(Math.random() * SHAPES.length);
                currentShape = SHAPES[randomIndex];
                currentColor = COLORS[randomIndex];
            } else {
                currentShape = nextShape;
                currentColor = nextColor;
            }
            
            // ç”Ÿæˆä¸‹ä¸€ä¸ªå½¢çŠ¶
            const nextIndex = Math.floor(Math.random() * SHAPES.length);
            nextShape = SHAPES[nextIndex];
            nextColor = COLORS[nextIndex];
            
            currentX = Math.floor((BOARD_WIDTH - currentShape[0].length) / 2);
            currentY = 0;
            
            if (!canMove(0, 0)) {
                gameOver();
            }
            
            // æ˜¾ç¤ºä¸‹ä¸€ä¸ªå½¢çŠ¶
            drawNextPiece();
        }
        
        function draw() {
            const gameBoard = document.getElementById('gameBoard');
            // ä¿å­˜pauseç•Œé¢çš„çŠ¶æ€
            const pauseScreen = document.getElementById('pauseScreen');
            const isPauseVisible = pauseScreen ? pauseScreen.style.display === 'block' : false;
            
            gameBoard.innerHTML = '<div id="pauseScreen" class="pause-screen">Pause</div>';
            
            // æ¢å¤pauseç•Œé¢çš„çŠ¶æ€
            if (isPauseVisible) {
                document.getElementById('pauseScreen').style.display = 'block';
            }
            
            // æ·»åŠ ç½‘æ ¼
            gameBoard.appendChild(createGrid());
            
            // ç»˜åˆ¶å·²å›ºå®šçš„æ–¹å—
            for (let y = 0; y < BOARD_HEIGHT; y++) {
                for (let x = 0; x < BOARD_WIDTH; x++) {
                    if (board[y][x]) {
                        drawBlock(x, y, board[y][x]);
                    }
                }
            }
            
            // ç»˜åˆ¶å½“å‰ç§»åŠ¨çš„æ–¹å—
            for (let y = 0; y < currentShape.length; y++) {
                for (let x = 0; x < currentShape[y].length; x++) {
                    if (currentShape[y][x]) {
                        drawBlock(currentX + x, currentY + y, currentColor);
                    }
                }
            }
        }
        
        function drawBlock(x, y, color) {
            const block = document.createElement('div');
            block.className = 'block';
            block.style.backgroundColor = color;
            block.style.left = x * BLOCK_SIZE + 'px';
            block.style.top = y * BLOCK_SIZE + 'px';
            document.getElementById('gameBoard').appendChild(block);
        }
        
        function canMove(offsetX, offsetY) {
            for (let y = 0; y < currentShape.length; y++) {
                for (let x = 0; x < currentShape[y].length; x++) {
                    if (currentShape[y][x]) {
                        const newX = currentX + x + offsetX;
                        const newY = currentY + y + offsetY;
                        
                        // æ£€æŸ¥è¾¹ç•Œï¼ŒåŒ…æ‹¬ä¸Šè¾¹ç•Œ
                        if (newX < 0 || newX >= BOARD_WIDTH || newY >= BOARD_HEIGHT || newY < 0) {
                            return false;
                        }
                        
                        // æ£€æŸ¥ä¸å…¶ä»–æ–¹å—çš„ç¢°æ’
                        if (newY >= 0 && board[newY][newX]) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }
        
        function merge() {
            for (let y = 0; y < currentShape.length; y++) {
                for (let x = 0; x < currentShape[y].length; x++) {
                    if (currentShape[y][x]) {
                        board[currentY + y][currentX + x] = currentColor;
                    }
                }
            }
        }
        
        function clearLines() {
            let linesCleared = 0;
            let y = BOARD_HEIGHT - 1;
            
            while (y >= 0) {
                if (board[y].every(cell => cell !== 0)) {
                    board.splice(y, 1);
                    board.unshift(Array(BOARD_WIDTH).fill(0));
                    linesCleared++;
                } else {
                    y--;
                }
            }
            
            if (linesCleared > 0) {
                //playSound('clearSound');
                const scoreMultiplier = [0, 100, 300, 500, 800];
                score += scoreMultiplier[linesCleared];
                document.getElementById('scoreValue').textContent = score;
            }
        }
        
        function rotate() {
            const newShape = Array(currentShape[0].length).fill()
                .map((_, i) => currentShape.map(row => row[row.length - 1 - i]));
            
            const oldShape = currentShape;
            const oldX = currentX;
            const oldY = currentY;
            
            currentShape = newShape;
            
            // è®¡ç®—æ—§å½¢çŠ¶çš„ä¸­å¿ƒç‚¹
            const oldWidth = oldShape[0].length;
            const oldHeight = oldShape.length;
            const oldCenterX = oldX + Math.floor(oldWidth / 2);
            const oldCenterY = oldY + Math.floor(oldHeight / 2);
            
            // è®¡ç®—æ–°å½¢çŠ¶çš„å°ºå¯¸
            const newWidth = newShape[0].length;
            const newHeight = newShape.length;
            
            // è®¡ç®—æ–°çš„åŸºå‡†ä½ç½®ï¼Œä¿æŒä¸­å¿ƒç‚¹ä¸å˜
            const baseX = oldCenterX - Math.floor(newWidth / 2);
            const baseY = oldCenterY - Math.floor(newHeight / 2);
            
            // å®šä¹‰å¢™è¸¢æ£€æŸ¥çš„é¡ºåºï¼Œä¼˜å…ˆæ£€æŸ¥åŸä½ç½®
            const kicks = [
                {x: 0, y: 0},     // åŸä½ç½®
                {x: -1, y: 0},    // å·¦ç§»1æ ¼
                {x: 1, y: 0},     // å³ç§»1æ ¼
                {x: 0, y: -1},    // ä¸Šç§»1æ ¼
                {x: 0, y: 1},     // ä¸‹ç§»1æ ¼
                {x: -1, y: -1},   // å·¦ä¸Š
                {x: 1, y: -1},    // å³ä¸Š
                {x: -1, y: 1},    // å·¦ä¸‹
                {x: 1, y: 1}      // å³ä¸‹
            ];
            
            // å°è¯•æ¯ä¸ªå¯èƒ½çš„ä½ç½®
            for (let kick of kicks) {
                currentX = baseX + kick.x;
                currentY = baseY + kick.y;
                
                if (canMove(0, 0)) {
                    return true;  // æ‰¾åˆ°æœ‰æ•ˆä½ç½®
                }
            }
            
            // å¦‚æœæ‰€æœ‰ä½ç½®éƒ½æ— æ•ˆï¼Œæ¢å¤åŸçŠ¶
            currentShape = oldShape;
            currentX = oldX;
            currentY = oldY;
            return false;
        }
        
        function gameOver() {
            // æ£€æŸ¥æ–°æ–¹å—æ˜¯å¦èƒ½æ”¾ç½®
            for (let x = 0; x < BOARD_WIDTH; x++) {
                if (board[0][x]) {
                    //playSound('gameOverSound');
                    document.getElementById('finalScore').textContent = score;
                    document.getElementById('gameOverModal').style.display = 'block';
                    clearInterval(gameInterval);
                    return true;
                }
            }
            return false;
        }
        
        function moveDown() {
            if (isPaused) return;
            
            if (canMove(0, 1)) {
                currentY++;
                draw();
            } else {
                merge();
                if (gameOver()) {
                    return;
                }
                clearLines();
                createNewShape();
                draw();
            }
        }
        
        function togglePause() {
            isPaused = !isPaused;
            document.getElementById('pauseScreen').style.display = isPaused ? 'block' : 'none';
            if (isPaused) {
                clearInterval(gameInterval);
            } else {
                gameInterval = setInterval(moveDown, 1000);
            }
        }
        
        function resetGame() {
            board = Array(BOARD_HEIGHT).fill().map(() => Array(BOARD_WIDTH).fill(0));
            score = 0;
            document.getElementById('scoreValue').textContent = '0';
            document.getElementById('gameOverModal').style.display = 'none';
            document.getElementById('pauseScreen').style.display = 'none';
            isPaused = false;
            
            // é‡ç½®ä¸‹ä¸€ä¸ªå½¢çŠ¶
            nextShape = undefined;
            nextColor = undefined;
            
            clearInterval(gameInterval);
            createNewShape();
            draw();
            gameInterval = setInterval(moveDown, 1000);
        }
        
        function drawNextPiece() {
            const nextPiece = document.getElementById('nextPiece');
            nextPiece.innerHTML = '';
            
            // è®¡ç®—å±…ä¸­åç§»
            const offsetX = (120 - nextShape[0].length * 30) / 2;
            const offsetY = (120 - nextShape.length * 30) / 2;
            
            for (let y = 0; y < nextShape.length; y++) {
                for (let x = 0; x < nextShape[y].length; x++) {
                    if (nextShape[y][x]) {
                        const block = document.createElement('div');
                        block.className = 'block';
                        block.style.backgroundColor = nextColor;
                        block.style.left = offsetX + x * BLOCK_SIZE + 'px';
                        block.style.top = offsetY + y * BLOCK_SIZE + 'px';
                        nextPiece.appendChild(block);
                    }
                }
            }
        }
        
        function hardDrop() {
            let dropDistance = 0;
            while (canMove(0, 1)) {
                currentY++;
                dropDistance++;
            }
            
            if (dropDistance > 0) {
                //playSound('dropSound');
                merge();
                if (gameOver()) {
                    return;
                }
                clearLines();
                createNewShape();
                draw();
            }
        }
        
        document.addEventListener('keydown', (e) => {
            
            if (isPaused && e.key !== 'p') return;
            
            switch (e.key) {
                case 'ArrowLeft':
                case 'a':
                    if (canMove(-1, 0)) {
                        //playSound('moveSound');
                        currentX--;
                        draw();
                    }
                    break;
                case 'ArrowRight':
                case 'd':
                    if (canMove(1, 0)) {
                        //playSound('moveSound');
                        currentX++;
                        draw();
                    }
                    break;
                case 'ArrowDown':
                case 's':
                    e.preventDefault();
                    moveDown();
                    break;
                case 'ArrowUp':
                case 'w':
                    e.preventDefault();
                    if (rotate()) {
                        //playSound('rotateSound');
                        draw();
                    }
                    break;
                case 'p':
                    togglePause();
                    break;
                case ' ':  // ç©ºæ ¼é”®å¿«é€Ÿä¸‹è½
                    e.preventDefault();
                    hardDrop();
                    break;
            }
        });
        
        createNewShape();
        draw();
        gameInterval = setInterval(moveDown, 1000);

        // æ·»åŠ å»ºç½‘æ ¼çš„å‡½æ•°
        function createGrid() {
            const gridOverlay = document.createElement('div');
            gridOverlay.className = 'grid-overlay';
            
            // åˆ›å»ºå‚ç›´çº¿
            for (let i = 1; i < BOARD_WIDTH; i++) {
                const verticalLine = document.createElement('div');
                verticalLine.className = 'grid-line-vertical';
                verticalLine.style.left = `${i * (100 / BOARD_WIDTH)}%`;
                gridOverlay.appendChild(verticalLine);
            }
            
            // åˆ›å»ºæ°´å¹³çº¿
            for (let i = 1; i < BOARD_HEIGHT; i++) {
                const horizontalLine = document.createElement('div');
                horizontalLine.className = 'grid-line-horizontal';
                horizontalLine.style.top = `${i * (100 / BOARD_HEIGHT)}%`;
                gridOverlay.appendChild(horizontalLine);
            }
            
            return gridOverlay;
        }

        // æ·»åŠ çª—å£å¤§å°æ”¹å˜äº‹ä»¶ç›‘å¬
        window.addEventListener('resize', function() {
            draw();
            drawNextPiece();
        });
    </script>
</body>
</html>
