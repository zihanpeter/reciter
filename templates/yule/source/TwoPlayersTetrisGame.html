<!DOCTYPE html>
<html>
<head>
    <title>Two Players Tetris</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
        }

        .game-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            margin: 20px auto;
        }

        .game-board {
            width: 300px;
            height: 600px;
            border: 2px solid #333;
            position: relative;
            background-color: #fff;
        }

        .block {
            width: 30px;
            height: 30px;
            position: absolute;
            border: 1px solid #fff;
            box-sizing: border-box;
        }

        .vs-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 10px;
        }

        .player-section {
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .game-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .score-container {
            background: #bbada0;
            padding: 8px 15px;
            border-radius: 6px;
            color: white;
            font-size: 20px;
            margin: 10px;
        }

        .score-label {
            font-size: 14px;
            color: #eee4da;
            margin-bottom: 3px;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .next-piece {
            width: 150px;
            height: 150px;
            border: 2px solid #333;
            position: relative;
            background: #fff;
            margin: 10px 0;
        }

        .button {
            padding: 8px 15px;
            margin: 5px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
        }

        .pause-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 48px;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .game-over-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            min-width: 300px;
            position: relative;
        }
        
        .modal-title {
            font-size: 36px;
            color: #776e65;
            margin-bottom: 20px;
        }
        
        .modal-score {
            font-size: 24px;
            margin: 20px 0;
            color: #776e65;
            line-height: 1.5;
        }
        
        .modal-button {
            background-color: #8f7a66;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        
        .modal-button:hover {
            background-color: #7f6a56;
        }

        .game-over-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 28px;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            text-align: center;
            line-height: 1.5;
        }

        .game-over-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <!-- Âú®game-containerÂâçÊ∑ªÂä†Áä∂ÊÄÅÊòæÁ§∫Âå∫Âüü -->
    <div class="game-status" style="text-align: center; margin: 10px 0;">
        <div style="display: flex; justify-content: space-around; width: 100%;">
            <div>Player 1 Game Over: <span id="gameOverStatus1">false</span></div>
            <div>Player 2 Game Over: <span id="gameOverStatus2">false</span></div>
        </div>
    </div>

    <div class="game-container">
        <!-- Áé©ÂÆ∂1Âå∫Âüü -->
        <div class="player-section">
            <div class="side-panel">
                <div class="next-title">Next:</div>
                <div class="next-piece" id="nextPiece1"></div>
            </div>
            <div class="game-info">
                <h2>Player 1 (WASD)</h2>
                <div class="score-container">
                    <div class="score-label">SCORE</div>
                    <div class="score-value" id="scoreValue1">0</div>
                </div>
                <div id="gameBoard1" class="game-board">
                    <div id="pauseScreen1" class="pause-screen">
                        <div class="pause-text">PAUSE</div>
                    </div>
                    <div id="gameOverScreen1" class="game-over-screen">
                        <div class="game-over-text">Your Game Is Over</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏≠Èó¥ÊéßÂà∂Âå∫Âüü -->
        <div class="vs-section">
            <h2>VS</h2>
            <button class="button" onclick="resetBothGames()">Restart</button>
            <button class="button" onclick="toggleBothPause()">Pause/Continue</button>
            <button class="button" onclick="toggleSound()">
                <span id="soundIcon">üîä</span>
            </button>
        </div>

        <!-- Áé©ÂÆ∂2Âå∫Âüü -->
        <div class="player-section">
            <div class="game-info">
                <h2>Player 2 (‚Üë‚Üê‚Üì‚Üí)</h2>
                <div class="score-container">
                    <div class="score-label">SCORE</div>
                    <div class="score-value" id="scoreValue2">0</div>
                </div>
                <div id="gameBoard2" class="game-board">
                    <div id="pauseScreen2" class="pause-screen">
                        <div class="pause-text">PAUSE</div>
                    </div>
                    <div id="gameOverScreen2" class="game-over-screen">
                        <div class="game-over-text">Your Game Is Over</div>
                    </div>
                </div>
            </div>
            <div class="side-panel">
                <div class="next-title">Next:</div>
                <div class="next-piece" id="nextPiece2"></div>
            </div>
        </div>
    </div>

    <!-- Ê∏∏ÊàèÁªìÊùüÔøΩÔøΩÔøΩ -->
    <div class="game-over-modal" id="gameOverModal">
        <div class="modal-content">
            <h2 class="modal-title">Game Over!</h2>
            <div class="modal-score">
                Player 1: <span id="finalScore1">0</span><br>
                Player 2: <span id="finalScore2">0</span><br>
                Winner: <span id="winner">None</span>
            </div>
            <button class="modal-button" onclick="resetBothGames()">Play Again</button>
        </div>
    </div>

    <script>
        // Âü∫Êú¨Â∏∏ÈáèÂÆö‰πâ
        const BOARD_WIDTH = 10;
        const BOARD_HEIGHT = 20;
        const BLOCK_SIZE = 30;
        
        // ÊñπÂùóÂΩ¢Áä∂ÂÆö‰πâ
        const SHAPES = [
            [[1, 1, 1, 1]], // I
            [[1, 1], [1, 1]], // O
            [[1, 1, 1], [0, 1, 0]], // T
            [[1, 1, 1], [1, 0, 0]], // L
            [[1, 1, 1], [0, 0, 1]], // J
            [[1, 1, 0], [0, 1, 1]], // S
            [[0, 1, 1], [1, 1, 0]]  // Z
        ];
        
        const COLORS = ['#00f0f0', '#f0f000', '#a000f0', '#f0a000', '#0000f0', '#00f000', '#f00000'];

        class TetrisGame {
            constructor(boardId, nextPieceId, scoreValueId) {
                this.boardId = boardId;
                this.nextPieceId = nextPieceId;
                this.scoreValueId = scoreValueId;
                this.board = Array(BOARD_HEIGHT).fill().map(() => Array(BOARD_WIDTH).fill(0));
                this.score = 0;
                this.currentShape = null;
                this.currentColor = null;
                this.currentX = 0;
                this.currentY = 0;
                this.nextShape = null;
                this.nextColor = null;
                this.isPaused = false;
                this.isGameOver = false;
                this.opponent = null;
            }

            // ÁßªÂä®ÊñπÊ≥ï
            moveLeft() {
                if (this.canMove(-1, 0)) {
                    //playSound('moveSound');
                    this.currentX--;
                    this.draw();
                    return true;
                }
                return false;
            }

            moveRight() {
                if (this.canMove(1, 0)) {
                    //playSound('moveSound');
                    this.currentX++;
                    this.draw();
                    return true;
                }
                return false;
            }

            moveDown() {
                if (this.isPaused || this.isGameOver) return false;
                
                if (this.canMove(0, 1)) {
                    this.currentY++;
                    this.draw();
                    return true;
                } else {
                    this.merge();
                    this.clearLines();
                    if (!this.createNewShape()) {
                        this.isGameOver = true;
                        this.updateGameOverStatus();  // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
                        if (this.opponent && this.opponent.isGameOver) {
                            showGameOver();
                        }
                        return false;
                    }
                    this.draw();
                    return false;
                }
            }

            // ÊóãËΩ¨ÊñπÊ≥ï
            rotate() {
                const newShape = Array(this.currentShape[0].length).fill()
                    .map((_, i) => this.currentShape.map(row => row[row.length - 1 - i]));
                
                const oldShape = this.currentShape;
                const oldX = this.currentX;
                const oldY = this.currentY;
                
                this.currentShape = newShape;
                
                // ËÆ°ÁÆóÊóßÂΩ¢Áä∂ÁöÑ‰∏≠ÂøÉÁÇπ
                const oldWidth = oldShape[0].length;
                const oldHeight = oldShape.length;
                const oldCenterX = oldX + Math.floor(oldWidth / 2);
                const oldCenterY = oldY + Math.floor(oldHeight / 2);
                
                // ËÆ°ÁÆóÊñ∞ÂΩ¢Áä∂ÁöÑÂ∞∫ÂØ∏
                const newWidth = newShape[0].length;
                const newHeight = newShape.length;
                
                // ËÆ°ÁÆóÊñ∞ÁöÑÂü∫ÂáÜ‰ΩçÁΩÆÔºå‰øùÊåÅ‰∏≠ÂøÉÁÇπ‰∏çÂèò
                const baseX = oldCenterX - Math.floor(newWidth / 2);
                const baseY = oldCenterY - Math.floor(newHeight / 2);
                
                // ÂÆö‰πâÂ¢ôË∏¢Ê£ÄÊü•ÁöÑÈ°∫Â∫èÔºå‰ºòÂÖàÊ£ÄÊü•Âéü‰ΩçÁΩÆ
                const kicks = [
                    {x: 0, y: 0},     // Âéü‰ΩçÁΩÆ
                    {x: -1, y: 0},    // Â∑¶Áßª1Ê†º
                    {x: 1, y: 0},     // Âè≥Áßª1Ê†º
                    {x: 0, y: -1},    // ‰∏äÁßª1Ê†º
                    {x: 0, y: 1},     // ‰∏ãÁßª1Ê†º
                    {x: -1, y: -1},   // Â∑¶‰∏ä
                    {x: 1, y: -1},    // Âè≥‰∏ä
                    {x: -1, y: 1},    // Â∑¶‰∏ã
                    {x: 1, y: 1}      // Âè≥‰∏ã
                ];
                
                for (let kick of kicks) {
                    this.currentX = baseX + kick.x;
                    this.currentY = baseY + kick.y;
                    
                    if (this.canMove(0, 0)) {
                        //playSound('rotateSound');
                        this.draw();
                        return true;
                    }
                }
                
                this.currentShape = oldShape;
                this.currentX = oldX;
                this.currentY = oldY;
                return false;
            }

            // Âø´ÈÄü‰∏ãËêΩ
            hardDrop() {
                if (this.isPaused || this.isGameOver) return;
                
                let dropDistance = 0;
                while (this.canMove(0, 1)) {
                    this.currentY++;
                    dropDistance++;
                }
                
                if (dropDistance > 0) {
                    //playSound('dropSound');
                    this.merge();
                    this.clearLines();
                    if (!this.createNewShape()) {
                        this.isGameOver = true;
                        this.updateGameOverStatus();  // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
                        if (this.opponent && this.opponent.isGameOver) {
                            showGameOver();
                        }
                        return false;
                    }
                    this.draw();
                }
            }

            // Á¢∞ÊíûÊ£ÄÊµã
            canMove(offsetX, offsetY) {
                for (let y = 0; y < this.currentShape.length; y++) {
                    for (let x = 0; x < this.currentShape[y].length; x++) {
                        if (this.currentShape[y][x]) {
                            const newX = this.currentX + x + offsetX;
                            const newY = this.currentY + y + offsetY;
                            
                            if (newX < 0 || newX >= BOARD_WIDTH || newY >= BOARD_HEIGHT || newY < 0) {
                                return false;
                            }
                            
                            if (this.board[newY][newX]) {
                                return false;
                            }
                        }
                    }
                }
                return true;
            }

            // ÂêàÂπ∂ÊñπÂùóÂà∞Ê∏∏ÊàèÊùø
            merge() {
                for (let y = 0; y < this.currentShape.length; y++) {
                    for (let x = 0; x < this.currentShape[y].length; x++) {
                        if (this.currentShape[y][x]) {
                            this.board[this.currentY + y][this.currentX + x] = this.currentColor;
                        }
                    }
                }
            }

            // Ê∏∏ÊàèÁªìÊùüÊ£ÄÊü•
            checkGameOver() {
                if (!this.canMove(0, 0)) {
                    this.isGameOver = true;
                    this.updateGameOverStatus();
                    
                    // ÊòæÁ§∫‰∏™‰∫∫Ê∏∏ÊàèÁªìÊùüÁïåÈù¢
                    const gameOverScreen = document.getElementById(
                        `gameOverScreen${this.boardId === 'gameBoard1' ? '1' : '2'}`
                    );
                    if (gameOverScreen) {
                        gameOverScreen.style.display = 'flex';
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶‰∏§‰∏™Áé©ÂÆ∂ÈÉΩÁªìÊùü‰∫Ü
                    if (this.opponent && this.opponent.isGameOver) {
                        showGameOver();
                    }
                    return true;
                }
                return false;
            }

            // ÂàõÂª∫Êñ∞ÊñπÂùó
            createNewShape() {
                const randomIndex = Math.floor(Math.random() * SHAPES.length);
                
                if (this.nextShape === null) {
                    this.currentShape = SHAPES[randomIndex];
                    this.currentColor = COLORS[randomIndex];
                } else {
                    this.currentShape = this.nextShape;
                    this.currentColor = this.nextColor;
                }

                const nextIndex = Math.floor(Math.random() * SHAPES.length);
                this.nextShape = SHAPES[nextIndex];
                this.nextColor = COLORS[nextIndex];

                this.currentX = Math.floor((BOARD_WIDTH - this.currentShape[0].length) / 2);
                this.currentY = 0;

                // Ê£ÄÊü•Êñ∞ÊñπÂùóÊòØÂê¶ËÉΩÊîæÁΩÆÂú®Ëµ∑Âßã‰ΩçÁΩÆ
                if (!this.canMove(0, 0)) {
                    this.isGameOver = true;
                    this.updateGameOverStatus();  // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
                    if (this.opponent && this.opponent.isGameOver) {
                        showGameOver();
                    }
                    return false;
                }

                this.drawNextPiece();
                return true;
            }

            // ÁªòÂà∂‰∏ã‰∏Ä‰∏™ÊñπÂùóÈ¢ÑËßà
            drawNextPiece() {
                const nextPiece = document.getElementById(this.nextPieceId);
                nextPiece.innerHTML = '';
                
                const offsetX = (150 - this.nextShape[0].length * BLOCK_SIZE) / 2;
                const offsetY = (150 - this.nextShape.length * BLOCK_SIZE) / 2;
                
                for (let y = 0; y < this.nextShape.length; y++) {
                    for (let x = 0; x < this.nextShape[y].length; x++) {
                        if (this.nextShape[y][x]) {
                            const block = document.createElement('div');
                            block.className = 'block';
                            block.style.backgroundColor = this.nextColor;
                            block.style.left = offsetX + x * BLOCK_SIZE + 'px';
                            block.style.top = offsetY + y * BLOCK_SIZE + 'px';
                            nextPiece.appendChild(block);
                        }
                    }
                }
            }

            // ‰øÆÊîπdrawÊñπÊ≥ï
            draw() {
                const gameBoard = document.getElementById(this.boardId);
                const pauseScreen = gameBoard.querySelector('.pause-screen');
                const gameOverScreen = gameBoard.querySelector('.game-over-screen');
                const isPauseVisible = pauseScreen ? pauseScreen.style.display === 'flex' : false;
                const isGameOverVisible = gameOverScreen ? gameOverScreen.style.display === 'flex' : false;
                
                // Ê∏ÖÁ©∫Ê∏∏ÊàèÊùøÔºå‰ΩÜ‰øùÁïôÊöÇÂÅúÂíåÊ∏∏ÊàèÁªìÊùüÂ±èÂπï
                gameBoard.innerHTML = `
                    <div class="pause-screen" style="display: ${isPauseVisible ? 'flex' : 'none'}">
                        <div class="pause-text">PAUSE</div>
                    </div>
                    <div class="game-over-screen" style="display: ${isGameOverVisible ? 'flex' : 'none'}">
                        <div class="game-over-text">
                            Your Game Is Over<br>
                            Score: ${this.score}
                        </div>
                    </div>
                `;

                // ÁªòÂà∂Â∑≤Âõ∫ÂÆöÁöÑÊñπÂùó
                for (let y = 0; y < BOARD_HEIGHT; y++) {
                    for (let x = 0; x < BOARD_WIDTH; x++) {
                        if (this.board[y][x]) {
                            this.drawBlock(x, y, this.board[y][x]);
                        }
                    }
                }

                // ÁªòÂà∂ÂΩìÂâçÁßªÂä®ÁöÑÊñπÂùó
                if (this.currentShape) {
                    for (let y = 0; y < this.currentShape.length; y++) {
                        for (let x = 0; x < this.currentShape[y].length; x++) {
                            if (this.currentShape[y][x]) {
                                this.drawBlock(this.currentX + x, this.currentY + y, this.currentColor);
                            }
                        }
                    }
                }
            }

            // ÁªòÂà∂Âçï‰∏™ÊñπÂùó
            drawBlock(x, y, color) {
                const block = document.createElement('div');
                block.className = 'block';
                block.style.backgroundColor = color;
                block.style.left = (x * BLOCK_SIZE) + 'px';
                block.style.top = (y * BLOCK_SIZE) + 'px';
                document.getElementById(this.boardId).appendChild(block);
            }

            // Ê∑ªÂä†setOpponentÊñπÊ≥ï
            setOpponent(opponent) {
                this.opponent = opponent;
            }

            // Ê∑ªÂä†clearLinesÊñπÊ≥ï
            clearLines() {
                let linesCleared = 0;
                let y = BOARD_HEIGHT - 1;
                
                while (y >= 0) {
                    if (this.board[y].every(cell => cell !== 0)) {
                        this.board.splice(y, 1);
                        this.board.unshift(Array(BOARD_WIDTH).fill(0));
                        linesCleared++;
                    } else {
                        y--;
                    }
                }
                
                if (linesCleared > 0) {
                    // Calculate score based on lines cleared
                    const scoreMultiplier = [100, 300, 500, 800]; // 1, 2, 3, or 4 lines
                    this.score += scoreMultiplier[linesCleared - 1] || 800;
                    
                    // Update score display
                    document.getElementById(this.scoreValueId).textContent = this.score;
                }
            }

            // ‰øÆÊîπÂàùÂßãÂåñÊñπÊ≥ï
            init() {
                // ÈáçÁΩÆÊâÄÊúâÊ∏∏ÊàèÁä∂ÊÄÅ
                this.board = Array(BOARD_HEIGHT).fill().map(() => Array(BOARD_WIDTH).fill(0));
                this.score = 0;
                this.currentShape = null;
                this.nextShape = null;
                this.currentColor = null;
                this.nextColor = null;
                this.isPaused = false;
                this.isGameOver = false;
                
                // Êõ¥Êñ∞Ê∏∏ÊàèÁä∂ÊÄÅÊòæÁ§∫
                this.updateGameOverStatus();
                
                // Êõ¥Êñ∞ÂàÜÊï∞ÊòæÁ§∫
                document.getElementById(this.scoreValueId).textContent = '0';
                
                // ÂàõÂª∫Á¨¨‰∏Ä‰∏™ÊñπÂùó
                this.createNewShape();
                this.draw();
            }

            updateGameOverStatus() {
                const statusElement = document.getElementById(
                    this.boardId === 'gameBoard1' ? 'gameOverStatus1' : 'gameOverStatus2'
                );
                if (statusElement) {
                    statusElement.textContent = this.isGameOver.toString();
                    // Ê∑ªÂä†ËßÜËßâÂèçÈ¶à
                    if (this.isGameOver) {
                        document.querySelector(`#${this.boardId}`).style.opacity = '0.7';
                    }
                }
            }
        }

        // ÂàõÂª∫Ê∏∏ÊàèÂÆû‰æã
        let game1 = new TetrisGame('gameBoard1', 'nextPiece1', 'scoreValue1');
        let game2 = new TetrisGame('gameBoard2', 'nextPiece2', 'scoreValue2');

        // ËÆæÁΩÆÂØπÊâãÂºïÁî®
        game1.setOpponent(game2);
        game2.setOpponent(game1);

        // Ê∑ªÂä†Ê∏∏ÊàèÊéßÂà∂ÂáΩÊï∞
        function toggleBothPause() {
            game1.isPaused = !game1.isPaused;
            game2.isPaused = !game2.isPaused;
            
            // Ê≠£Á°ÆËÆæÁΩÆpauseÂ±èÂπïÁöÑÊòæÁ§∫
            document.querySelector(`#${game1.boardId} .pause-screen`).style.display = 
                game1.isPaused ? 'flex' : 'none';
            document.querySelector(`#${game2.boardId} .pause-screen`).style.display = 
                game2.isPaused ? 'flex' : 'none';
            
            if (game1.isPaused) {
                clearInterval(gameInterval);
            } else {
                gameInterval = setInterval(gameLoop, 1000);
            }
        }
 
        function resetBothGames() {
            // Ê∏ÖÈô§Áé∞ÊúâÁöÑÊ∏∏ÊàèÂæ™ÁéØ
            if (gameInterval) {
                clearInterval(gameInterval);
            }
            
            // ÈáçÁΩÆÊ∏∏ÊàèÂÆû‰æã
            game1 = new TetrisGame('gameBoard1', 'nextPiece1', 'scoreValue1');
            game2 = new TetrisGame('gameBoard2', 'nextPiece2', 'scoreValue2');
            
            // ÈáçÊñ∞ËÆæÁΩÆÂØπÊâãÂÖ≥Á≥ª
            game1.setOpponent(game2);
            game2.setOpponent(game1);
            
            // Ê∏ÖÈô§Ê∏∏ÊàèÊùøÂÜÖÂÆπ
            document.getElementById('gameBoard1').innerHTML = '';
            document.getElementById('gameBoard2').innerHTML = '';
            
            // ÈáçÁΩÆÊâÄÊúâÊòæÁ§∫
            document.getElementById('scoreValue1').textContent = '0';
            document.getElementById('scoreValue2').textContent = '0';
            document.getElementById('finalScore1').textContent = '0';
            document.getElementById('finalScore2').textContent = '0';
            document.getElementById('winner').textContent = 'None';
            
            // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅÊòæÁ§∫
            document.getElementById('gameOverStatus1').textContent = 'false';
            document.getElementById('gameOverStatus2').textContent = 'false';
            
            // ÈáçÁΩÆÊ∏∏ÊàèÊùøÈÄèÊòéÂ∫¶
            document.getElementById('gameBoard1').style.opacity = '1';
            document.getElementById('gameBoard2').style.opacity = '1';
            
            // ÈáçÊñ∞Ê∑ªÂä†ÊöÇÂÅúÂíåÊ∏∏ÊàèÁªìÊùüÂ±èÂπï
            ['gameBoard1', 'gameBoard2'].forEach(boardId => {
                const board = document.getElementById(boardId);
                board.innerHTML = `
                    <div id="pauseScreen${boardId.slice(-1)}" class="pause-screen">
                        <div class="pause-text">PAUSE</div>
                    </div>
                    <div id="gameOverScreen${boardId.slice(-1)}" class="game-over-screen">
                        <div class="game-over-text">Your Game Is Over</div>
                    </div>
                `;
            });
            
            // ÈöêËóèÊâÄÊúâÊ∏∏ÊàèÁªìÊùüÁõ∏ÂÖ≥ÁöÑÊòæÁ§∫
            document.getElementById('gameOverModal').style.display = 'none';
            document.querySelectorAll('.game-over-screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.querySelectorAll('.pause-screen').forEach(screen => {
                screen.style.display = 'none';
            });
            
            // ÂàùÂßãÂåñ‰∏§‰∏™Ê∏∏Êàè
            game1.init();
            game2.init();
            
            // ÈáçÂêØÊ∏∏ÊàèÂæ™ÁéØ
            gameInterval = setInterval(gameLoop, 1000);
        }

        // Ê∏∏Êàè‰∏ªÂæ™ÁéØ
        function gameLoop() {
            if (!game1.isPaused && !game1.isGameOver) {
                game1.moveDown();
            }
            if (!game2.isPaused && !game2.isGameOver) {
                game2.moveDown();
            }

            // Ê£ÄÊü•Ê∏∏ÊàèÊòØÂê¶ÁªìÊùü
            if (game1.isGameOver && game2.isGameOver) {
                showGameOver();
                clearInterval(gameInterval);
            }
        }

        // Ê∑ªÂä†ÈîÆÁõòÊéßÂà∂
        document.addEventListener('keydown', (e) => {
            // Èò≤Ê≠¢ÊñπÂêëÈîÆÂíåÁ©∫Ê†ºÈîÆÊªöÂä®È°µÈù¢
            if (['ArrowUp', 'ArrowDown', 'Space', ' '].includes(e.key)) {
                e.preventDefault();
            }

            // Áé©ÂÆ∂1ÁöÑÊéßÂà∂ÔºàWASDÔºâ
            if (!game1.isPaused && !game1.isGameOver) {
                switch (e.key.toLowerCase()) {
                    case 'a': game1.moveLeft(); break;
                    case 'd': game1.moveRight(); break;
                    case 's': game1.moveDown(); break;
                    case 'w': game1.rotate(); break;
                    case ' ': game1.hardDrop(); break;
                }
            }

            // Áé©ÂÆ∂2ÁöÑÊéßÂà∂ÔºàÊñπÂêëÈîÆÔºâ
            if (!game2.isPaused && !game2.isGameOver) {
                switch (e.key) {
                    case 'ArrowLeft': game2.moveLeft(); break;
                    case 'ArrowRight': game2.moveRight(); break;
                    case 'ArrowDown': game2.moveDown(); break;
                    case 'ArrowUp': game2.rotate(); break;
                    case 'Enter': game2.hardDrop(); break;
                }
            }

            // ÈÄöÁî®ÊéßÂà∂
            if (e.key === 'p') {
                toggleBothPause();
            }
        });

        // ÂàùÂßãÂåñÊ∏∏Êàè
        let gameInterval;
        resetBothGames();

        // Ê∑ªÂä†showGameOverÂáΩÊï∞
        function showGameOver() {
            clearInterval(gameInterval);
            
            // Êõ¥Êñ∞ÊúÄÁªàÂàÜÊï∞
            document.getElementById('finalScore1').textContent = game1.score;
            document.getElementById('finalScore2').textContent = game2.score;
            
            // Á°ÆÂÆöËé∑ËÉúËÄÖ
            let winnerText;
            if (game1.score > game2.score) {
                winnerText = "Player 1 Wins!";
            } else if (game2.score > game1.score) {
                winnerText = "Player 2 Wins!";
            } else {
                winnerText = "It's a Tie!";
            }
            
            // Êõ¥Êñ∞Ê∏∏ÊàèÁªìÊùüÊ®°ÊÄÅÊ°ÜÁöÑÂÜÖÂÆπ
            document.getElementById('winner').textContent = winnerText;
            
            // ÊòæÁ§∫Ê∏∏ÊàèÁªìÊùüÊ®°ÊÄÅÊ°Ü
            const gameOverModal = document.getElementById('gameOverModal');
            gameOverModal.style.display = 'flex';  // Êîπ‰∏∫flex‰ª•ÂÆûÁé∞Â±Ö‰∏≠

            // Ê∑ªÂä†Ê∏∏ÊàèÁªìÊùüÁöÑÊ†∑Âºè
            document.querySelector(`#${game1.boardId}`).style.opacity = '0.7';
            document.querySelector(`#${game2.boardId}`).style.opacity = '0.7';
        }
    </script>
</body>
</html> 